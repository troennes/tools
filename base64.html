<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Base64 Encoder / Decoder</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#121a33;
      --panel2:#0f1730;
      --text:#e9ecff;
      --muted:#aab2e6;
      --accent:#7aa2ff;
      --danger:#ff6b6b;
      --ok:#7dffb2;
      --border:rgba(255,255,255,.10);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: radial-gradient(1200px 700px at 20% 10%, rgba(122,162,255,.20), transparent 55%),
                  radial-gradient(900px 600px at 80% 0%, rgba(125,255,178,.12), transparent 55%),
                  radial-gradient(1200px 800px at 50% 90%, rgba(255,107,107,.10), transparent 60%),
                  var(--bg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .app{
      width:min(1100px, 100%);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      border-radius:calc(var(--radius) + 6px);
      overflow:hidden;
    }
    header{
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:space-between;
      padding:18px 18px 12px 18px;
      border-bottom:1px solid var(--border);
      background:rgba(0,0,0,.12);
    }
    .title{
      display:flex; flex-direction:column; gap:4px;
    }
    h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
      font-weight:700;
    }
    .subtitle{
      margin:0;
      font-size:13px;
      color:var(--muted);
      line-height:1.3;
    }
    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .chip{
      border:1px solid var(--border);
      background:rgba(18,26,51,.65);
      border-radius:999px;
      padding:8px 10px;
      display:flex;
      gap:10px;
      align-items:center;
      user-select:none;
    }
    .chip label{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .chip input[type="checkbox"]{ width:16px; height:16px; accent-color: var(--accent); }
    main{ padding:16px; }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      header{ flex-direction:column; align-items:flex-start; }
      .toolbar{ justify-content:flex-start; }
    }
    .card{
      background:rgba(18,26,51,.70);
      border:1px solid var(--border);
      border-radius:var(--radius);
      overflow:hidden;
    }
    .card header{
      padding:12px 12px 10px 12px;
      background:rgba(0,0,0,.10);
      border-bottom:1px solid var(--border);
    }
    .card header .card-title{
      display:flex;
      width:100%;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .card h2{
      margin:0;
      font-size:13px;
      letter-spacing:.3px;
      text-transform:uppercase;
      color:var(--muted);
      font-weight:800;
    }
    .badge{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      padding:4px 8px;
      border:1px solid var(--border);
      border-radius:999px;
      background:rgba(0,0,0,.10);
      white-space:nowrap;
    }
    textarea{
      width:100%;
      height:320px;
      padding:12px;
      border:0;
      outline:none;
      resize:vertical;
      background:var(--panel2);
      color:var(--text);
      font-family:var(--mono);
      font-size:13px;
      line-height:1.45;
      border-radius:0;
    }
    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding:12px;
      border-top:1px solid var(--border);
      background:rgba(0,0,0,.06);
      align-items:center;
      justify-content:space-between;
    }
    .left-controls, .right-controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    button{
      appearance:none;
      border:1px solid var(--border);
      background:rgba(122,162,255,.14);
      color:var(--text);
      padding:9px 12px;
      border-radius:12px;
      font-weight:700;
      font-size:13px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{ background:rgba(122,162,255,.22); border-color:rgba(122,162,255,.40); }
    button:active{ transform: translateY(1px); }
    button.secondary{ background:rgba(255,255,255,.06); }
    button.secondary:hover{ background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.22); }
    button.danger{ background:rgba(255,107,107,.16); }
    button.danger:hover{ background:rgba(255,107,107,.24); border-color:rgba(255,107,107,.45); }
    button.ok{ background:rgba(125,255,178,.14); }
    button.ok:hover{ background:rgba(125,255,178,.22); border-color:rgba(125,255,178,.42); }
    .hint{
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }
    .status{
      padding:10px 12px;
      border-top:1px solid var(--border);
      background:rgba(0,0,0,.10);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .status .msg{
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
    }
    .status .msg strong{
      color:var(--text);
      font-weight:800;
    }
    .status .msg.error strong{ color: var(--danger); }
    .status .msg.ok strong{ color: var(--ok); }
    .footer{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      padding:14px 16px 18px 16px;
      border-top:1px solid var(--border);
      color:var(--muted);
      font-size:12px;
    }
    input[type="file"]{ display:none; }
    .file-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:9px 12px;
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.18);
      background:rgba(255,255,255,.05);
      cursor:pointer;
      user-select:none;
      font-weight:700;
      font-size:13px;
      color:var(--text);
    }
    .file-btn:hover{ border-color:rgba(122,162,255,.45); background:rgba(122,162,255,.12); }
    .divider{
      height:28px;
      width:1px;
      background:rgba(255,255,255,.10);
      margin:0 2px;
    }
    .tiny{
      font-family:var(--mono);
      font-size:11px;
      opacity:.9;
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Base64 encoder and decoder">
    <header>
      <div class="title">
        <h1>Base64 Encoder / Decoder</h1>
        <p class="subtitle">Encode text or files to Base64, or decode Base64 back to text / bytes. UTF-8 safe.</p>
      </div>
      <div class="toolbar">
        <div class="chip" title="When enabled, Encode/Decode runs while you type (debounced).">
          <label for="live">Live mode</label>
          <input id="live" type="checkbox" />
        </div>
        <div class="chip" title="Use URL-safe Base64 (replace +/ with -_ and optionally strip padding).">
          <label for="urlsafe">URL-safe</label>
          <input id="urlsafe" type="checkbox" />
        </div>
        <div class="chip" title="Ignore whitespace/newlines when decoding (handy for wrapped Base64).">
          <label for="ws">Ignore whitespace</label>
          <input id="ws" type="checkbox" checked />
        </div>
        <div class="chip" title="Strip '=' padding when encoding (URL-safe only).">
          <label for="nopad">No padding</label>
          <input id="nopad" type="checkbox" />
        </div>
      </div>
    </header>

    <main>
      <div class="grid">
        <section class="card" aria-label="Input panel">
          <header>
            <div class="card-title">
              <h2>Input</h2>
              <span class="badge" id="inputMeta">0 chars</span>
            </div>
          </header>
          <textarea id="input" spellcheck="false" placeholder="Type or paste here…"></textarea>
          <div class="controls">
            <div class="left-controls">
              <button class="ok" id="btnEncode" title="Encode Input → Output">Encode →</button>
              <button class="ok" id="btnDecode" title="Decode Input → Output">Decode →</button>
              <div class="divider" aria-hidden="true"></div>
              <label class="file-btn" for="fileIn" title="Choose a file to encode to Base64">
                Encode file…
                <span class="tiny" id="fileName">none</span>
              </label>
              <input id="fileIn" type="file" />
            </div>
            <div class="right-controls">
              <button class="secondary" id="btnSwap" title="Swap input and output">Swap</button>
              <button class="danger" id="btnClear" title="Clear both panels">Clear</button>
            </div>
          </div>
        </section>

        <section class="card" aria-label="Output panel">
          <header>
            <div class="card-title">
              <h2>Output</h2>
              <span class="badge" id="outputMeta">0 chars</span>
            </div>
          </header>
          <textarea id="output" spellcheck="false" placeholder="Result appears here…"></textarea>
          <div class="controls">
            <div class="left-controls">
              <button class="secondary" id="btnCopyOut" title="Copy output to clipboard">Copy output</button>
              <button class="secondary" id="btnCopyIn" title="Copy input to clipboard">Copy input</button>
            </div>
            <div class="right-controls">
              <button class="secondary" id="btnDownloadDecoded" title="Download decoded bytes (treat Output as Base64)">Download decoded</button>
            </div>
          </div>
        </section>
      </div>

      <div class="status" role="status" aria-live="polite">
        <div class="msg" id="statusMsg"><strong>Ready.</strong> Tip: If decoding fails, check URL-safe or whitespace options.</div>
        <div class="hint" id="statsHint">Input bytes: <span id="inBytes">0</span> · Output bytes: <span id="outBytes">0</span></div>
      </div>
    </main>

    <div class="footer">
      <div>Everything runs locally in your browser. No network calls.</div>
      <div class="tiny">Supports UTF-8 text, wrapped Base64, and URL-safe variants.</div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const el = {
    input: $("input"),
    output: $("output"),
    live: $("live"),
    urlsafe: $("urlsafe"),
    ws: $("ws"),
    nopad: $("nopad"),
    inputMeta: $("inputMeta"),
    outputMeta: $("outputMeta"),
    statusMsg: $("statusMsg"),
    inBytes: $("inBytes"),
    outBytes: $("outBytes"),
    fileIn: $("fileIn"),
    fileName: $("fileName"),
    btnEncode: $("btnEncode"),
    btnDecode: $("btnDecode"),
    btnSwap: $("btnSwap"),
    btnClear: $("btnClear"),
    btnCopyOut: $("btnCopyOut"),
    btnCopyIn: $("btnCopyIn"),
    btnDownloadDecoded: $("btnDownloadDecoded"),
  };

  // ---- UTF-8 safe Base64 helpers ----
  function bytesToBase64(bytes) {
    // Convert bytes to binary string in manageable chunks to avoid call stack / argument limits.
    const chunkSize = 0x8000;
    let binary = "";
    for (let i = 0; i < bytes.length; i += chunkSize) {
      const chunk = bytes.subarray(i, i + chunkSize);
      binary += String.fromCharCode.apply(null, chunk);
    }
    return btoa(binary);
  }

  function base64ToBytes(b64) {
    const binary = atob(b64);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
    return bytes;
  }

  function encodeTextToBase64(text) {
    const bytes = new TextEncoder().encode(text);
    return { b64: bytesToBase64(bytes), bytes };
  }

  function decodeBase64ToText(b64) {
    const bytes = base64ToBytes(b64);
    const text = new TextDecoder("utf-8", { fatal: false }).decode(bytes);
    return { text, bytes };
  }

  function normalizeForDecode(s) {
    let v = s;
    if (el.ws.checked) v = v.replace(/\s+/g, "");
    // If URL-safe, convert back to standard form
    v = v.replace(/-/g, "+").replace(/_/g, "/");
    // Pad to multiple of 4 if needed
    const pad = v.length % 4;
    if (pad === 2) v += "==";
    else if (pad === 3) v += "=";
    else if (pad === 1) throw new Error("Invalid Base64 length (mod 4 == 1).");
    return v;
  }

  function makeUrlSafe(b64) {
    let v = b64.replace(/\+/g, "-").replace(/\//g, "_");
    if (el.nopad.checked) v = v.replace(/=+$/g, "");
    return v;
  }

  function setStatus(kind, title, detail) {
    const msg = el.statusMsg;
    msg.className = "msg" + (kind ? (" " + kind) : "");
    msg.innerHTML = `<strong>${escapeHtml(title)}</strong>${detail ? " " + escapeHtml(detail) : ""}`;
  }

  function escapeHtml(s) {
    return String(s).replace(/[&<>"']/g, (c) => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
  }

  function updateMeta() {
    const inText = el.input.value;
    const outText = el.output.value;
    el.inputMeta.textContent = `${inText.length.toLocaleString()} chars`;
    el.outputMeta.textContent = `${outText.length.toLocaleString()} chars`;

    // Byte counts (best-effort)
    const inBytes = new TextEncoder().encode(inText).length;
    const outBytes = new TextEncoder().encode(outText).length;
    el.inBytes.textContent = inBytes.toLocaleString();
    el.outBytes.textContent = outBytes.toLocaleString();
  }

  function tryEncode() {
    try {
      const { b64, bytes } = encodeTextToBase64(el.input.value);
      let out = b64;
      if (el.urlsafe.checked) out = makeUrlSafe(out);
      el.output.value = out;
      setStatus("ok", "Encoded.", `${bytes.length.toLocaleString()} bytes → Base64.`);
    } catch (e) {
      setStatus("error", "Encode failed.", e?.message || String(e));
    } finally {
      updateMeta();
    }
  }

  function tryDecode() {
    try {
      const normalized = normalizeForDecode(el.input.value);
      const { text, bytes } = decodeBase64ToText(normalized);
      el.output.value = text;
      setStatus("ok", "Decoded.", `Base64 → ${bytes.length.toLocaleString()} bytes (UTF-8 decoded).`);
    } catch (e) {
      setStatus("error", "Decode failed.", e?.message || String(e));
    } finally {
      updateMeta();
    }
  }

  function swap() {
    const a = el.input.value;
    el.input.value = el.output.value;
    el.output.value = a;
    setStatus("", "Swapped.", "");
    updateMeta();
  }

  function clearAll() {
    el.input.value = "";
    el.output.value = "";
    el.fileIn.value = "";
    el.fileName.textContent = "none";
    setStatus("", "Cleared.", "");
    updateMeta();
  }

  async function copyText(text) {
    try {
      await navigator.clipboard.writeText(text);
      setStatus("ok", "Copied.", "Clipboard updated.");
    } catch {
      // Fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      setStatus("ok", "Copied.", "Clipboard updated (fallback).");
    }
  }

  function debounce(fn, ms) {
    let t = null;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), ms);
    };
  }

  const liveRun = debounce(() => {
    if (!el.live.checked) return;
    // Heuristic: if input looks like base64, decode; else encode.
    const s = el.input.value.trim();
    const looksLikeB64 = s.length > 0 && /^[A-Za-z0-9+/_\-\s=]+$/.test(s) && s.length >= 8;
    if (looksLikeB64) tryDecode();
    else tryEncode();
  }, 200);

  async function encodeFile(file) {
    const buf = await file.arrayBuffer();
    const bytes = new Uint8Array(buf);
    let b64 = bytesToBase64(bytes);
    if (el.urlsafe.checked) b64 = makeUrlSafe(b64);
    el.output.value = b64;
    setStatus("ok", "File encoded.", `${file.name} · ${bytes.length.toLocaleString()} bytes → Base64.`);
    updateMeta();
  }

  function downloadDecodedFromOutput() {
    try {
      const normalized = normalizeForDecode(el.output.value);
      const bytes = base64ToBytes(normalized);
      const blob = new Blob([bytes], { type: "application/octet-stream" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "decoded.bin";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      setStatus("ok", "Downloaded.", `${bytes.length.toLocaleString()} bytes saved as decoded.bin.`);
    } catch (e) {
      setStatus("error", "Download failed.", e?.message || String(e));
    }
  }

  // ---- Events ----
  el.btnEncode.addEventListener("click", tryEncode);
  el.btnDecode.addEventListener("click", tryDecode);
  el.btnSwap.addEventListener("click", swap);
  el.btnClear.addEventListener("click", clearAll);
  el.btnCopyOut.addEventListener("click", () => copyText(el.output.value));
  el.btnCopyIn.addEventListener("click", () => copyText(el.input.value));
  el.btnDownloadDecoded.addEventListener("click", downloadDecodedFromOutput);

  el.input.addEventListener("input", () => { updateMeta(); liveRun(); });
  el.output.addEventListener("input", () => updateMeta());

  el.urlsafe.addEventListener("change", () => {
    // Enabling URL-safe makes "No padding" relevant; otherwise it is ignored.
    if (!el.urlsafe.checked) el.nopad.checked = false;
    liveRun();
  });
  el.ws.addEventListener("change", liveRun);
  el.nopad.addEventListener("change", liveRun);
  el.live.addEventListener("change", liveRun);

  el.fileIn.addEventListener("change", async () => {
    const file = el.fileIn.files && el.fileIn.files[0];
    if (!file) return;
    el.fileName.textContent = file.name;
    try {
      await encodeFile(file);
    } catch (e) {
      setStatus("error", "File encode failed.", e?.message || String(e));
    }
  });

  // Initialize
  updateMeta();
})();
</script>
</body>
</html>
